1. Extract Population-Specific VCF Files
vcftools \
  --gzvcf Coconut.prune.in.vcf \
  --indv popA_sample_1 \
  --indv popA_sample_2 \
  --indv popB_sample_1 \
  --indv popB_sample_2 \
  --indv popC_sample_1 \
  ...
  --indv all_samples_to_analyze \
  --recode \
  --out Coconut_smcpp

# Compress and index
bgzip -f Coconut_smcpp.vcf
tabix Coconut_smcpp.vcf.gz

2. Convert VCF to SMC Format
cat Chr.txt | while read line; do
    smc++ vcf2smc \
       Coconut_smcpp.vcf.gz \
        ./popA/popA_$line.smc.gz \
        $line \
        popA:sample1,sample2,sample3,...,sampleN
done

3. Estimate Demographic History
smc++ estimate -o popA/ $Mu ./popA/popA.*.smc.gz

## $Mu is the mutation rate; obtain from literature for your species.

4. Plot Demographic History
smc++ plot -c SMCPP_popA.pdf ./popA/model.final.json -g $generation

## $generation is the generation time (birth to reproductive age). Example: humans = 25, mouse = 1.

5. Multiple Populations

Repeat steps 2â€“4 for each population of interest.

6. Estimate Divergence Time Between Two Populations
6.1 Convert VCF to SMC for Pairwise Populations
mkdir G1toG2_3

cat Chr.txt | while read line; do
    smc++ vcf2smc \
        Coconut_smcpp.vcf.gz \
        ./popAtopopB/popAtopopB_$line.smc.gz \
        $line \
        popA:sample1,sample2,... \
        popB:sample1,sample2,...
    
    smc++ vcf2smc \
        Coconut_smcpp.vcf.gz \
        ./popAtopopB/popBtopopA_$line.smc.gz \
        $line \
        popB:sample1,sample2,... \
        popA:sample1,sample2,...
done

6.2 Split and Estimate Divergence Time
smc++ split -o split_popAtopopB/ \
    popA/model.final.json \
    popB/model.final.json \
    popAtopopB/*.smc.gz

6.3 Plot Joint Demographic History
smc++ plot joint.pdf split_G1toG3/model.final.json -c
